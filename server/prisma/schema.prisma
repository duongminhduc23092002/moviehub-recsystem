generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model users {
  id         Int          @id @default(autoincrement())
  name       String       @db.VarChar(100)
  email      String       @unique(map: "email") @db.VarChar(150)
  password   String       @db.VarChar(255)
  role       user_role    @default(user)
  created_at DateTime?    @default(now()) @db.DateTime(0)
  ratings    ratings[]
  user_data  user_data[]  @ignore
  users_data users_data[] @ignore
  watchlist  watchlist[]
}

model genres {
  id           Int            @id @default(autoincrement())
  name         String         @unique(map: "name") @db.VarChar(100)
  movie_genres movie_genres[]
}

model people {
  id          Int           @id @default(autoincrement())
  name        String        @db.VarChar(150)
  role        people_role
  avatar      String?       @db.VarChar(255)
  biography   String?       @db.Text
  birthday    DateTime?     @db.Date
  movie_casts movie_casts[]
}

model movies {
  id           Int            @id @default(autoincrement())
  title        String         @db.VarChar(255)
  description  String?        @db.Text
  poster       String?        @db.VarChar(255)
  year         Int?
  duration     Int?
  trailer_url  String?        @db.VarChar(255)
  created_at   DateTime?      @default(now()) @db.DateTime(0)
  keywords     String?        @db.Text
  final_score  Float?         
  movie_casts  movie_casts[]
  movie_genres movie_genres[]
  ratings      ratings[]
  watchlist    watchlist[]
  
  @@index([final_score], map: "idx_movies_final_score")
}

model movie_casts {
  id          Int     @id @default(autoincrement())
  movie_id    Int
  person_id   Int
  acting_role String? @db.VarChar(150)
  movies      movies  @relation(fields: [movie_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "movie_casts_ibfk_1")
  people      people  @relation(fields: [person_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "movie_casts_ibfk_2")

  @@index([movie_id], map: "idx_movie_cast_movie")
  @@index([person_id], map: "idx_movie_cast_person")
}

model movie_genres {
  id       Int    @id @default(autoincrement())
  movie_id Int
  genre_id Int
  movies   movies @relation(fields: [movie_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "movie_genres_ibfk_1")
  genres   genres @relation(fields: [genre_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "movie_genres_ibfk_2")

  @@unique([movie_id, genre_id], map: "uq_movie_genre")
  @@index([genre_id], map: "idx_movie_genre_genre")
  @@index([movie_id], map: "idx_movie_genre_movie")
}

model ratings {
  id         Int       @id @default(autoincrement())
  user_id    Int
  movie_id   Int
  score      Int?
  comment    String?   @db.Text
  created_at DateTime? @default(now()) @db.DateTime(0)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ratings_ibfk_1")
  movies     movies    @relation(fields: [movie_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ratings_ibfk_2")

  @@index([movie_id], map: "idx_rating_movie")
  @@index([user_id], map: "idx_rating_user")
}

model watchlist {
  id       Int      @id @default(autoincrement())
  user_id  Int
  movie_id Int
  added_at DateTime @default(now()) @db.DateTime(0)
  users    users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "watchlist_ibfk_1")
  movies   movies   @relation(fields: [movie_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "watchlist_ibfk_2")

  @@unique([user_id, movie_id], map: "unique_user_movie")
  @@index([user_id], map: "idx_watchlist_user")
  @@index([movie_id], map: "idx_watchlist_movie")
}


model users_data {
  movie_id  Int
  user_id   Int
  user_rate Float?
  liked     Boolean @default(false)
  users     users   @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_users_data_user")

  @@index([user_id], map: "fk_users_data_user")
  @@index([movie_id], map: "idx_users_data_csv_movie")
  @@ignore
}

model movies_sorted {
  movie_id      Int     @id
  title         String? @db.VarChar(255)
  release_year  Int?
  genres        String? @db.Text
  orginall_lang String? @db.VarChar(20)
  director      String? @db.VarChar(255)
  stars         String? @db.Text
  keywords      String? @db.Text
  rating        Float?
  rating_count  Int?
  final_score   Float?

  @@index([final_score], map: "idx_movies_sorted_score")
  @@index([release_year], map: "idx_movies_sorted_year")
}

model movies_cleaned {
  movie_id      Int     @id
  title         String? @db.VarChar(255)
  release_year  Int?
  genres        String? @db.Text
  orginall_lang String? @db.VarChar(20)
  director      String? @db.VarChar(255)
  stars         String? @db.Text
  keywords      String? @db.Text
  rating        Float?
  rating_count  Int?
  final_score   Float?

  @@index([final_score], map: "idx_movies_cleaned_score")
  @@index([release_year], map: "idx_movies_cleaned_year")
}


model movies_stage {
  movie_id      Int?
  title         String? @db.VarChar(255)
  release_year  Int?
  genres        String? @db.Text
  orginall_lang String? @db.VarChar(20)
  director      String? @db.VarChar(255)
  stars         String? @db.Text
  keywords      String? @db.Text
  rating        Float?
  rating_count  Int?
  final_score   Float?

  @@ignore
}


model user_data {
  movie_id  Int
  user_id   Int
  user_rate Float?
  liked     Boolean @default(false)
  users     users   @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_user_data_user")

  @@index([user_id], map: "fk_user_data_user")
  @@index([movie_id], map: "idx_user_data_csv_movie")
  @@ignore
}

enum people_role {
  actor
  director
}

enum user_role {
  user
  admin
}
